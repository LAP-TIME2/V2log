# 무게 원판 자동 감지 — 딥리서치 프롬프트

> 다른 AI(Gemini Deep Research, Perplexity Pro, ChatGPT Deep Research 등)에 전달할 프롬프트.
> 아래 전체를 복사해서 붙여넣으세요.

---

## 프롬프트 시작

```
당신은 Computer Vision + 헬스/피트니스 도메인의 수석 연구원입니다.

아래 상황을 정확히 이해한 뒤, 제가 정의한 문제에 대해 심층 조사해 주세요.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 프로젝트 배경
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

V2log는 스마트폰 카메라만으로 헬스 운동을 자동 기록하는 앱입니다.

**파이프라인 (Two-Stage)**:
- Stage 1 (무게 감지): 전면 카메라에 바벨을 보여주면 → YOLO가 원판 종류 감지 → 무게 자동 계산
- Stage 2 (횟수 카운팅): MediaPipe BlazePose로 관절 각도 추적 → 반복 횟수 자동 카운팅

Stage 2(횟수 카운팅)는 88~95% 정확도로 완성되었습니다.
**문제는 Stage 1(무게 감지)**, 특히 "겹친 원판 장수 추정"입니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
2. 현재 시스템 상세
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**YOLO 모델 (단일 원판 감지 — 이미 완성)**:
- YOLO26-N, .tflite 9.8MB
- 5개 클래스: plate_10kg, plate_15kg, plate_2.5kg, plate_20kg, plate_5kg
- mAP50: 96.2%, mAP50-95: 85.3%, Precision: 95.9%, Recall: 90.6%
- 학습 데이터: 926장 (537장 라벨링), Roboflow 관리
- → "이 원판이 20kg인지 10kg인지" 구분하는 것은 96% 정확도로 해결됨

**문제: 같은 종류 원판이 여러 장 겹쳐 있을 때 장수 추정**
- 바벨에는 같은 원판이 2~5장 겹쳐 끼워짐 (예: 20kg × 3장 = 바벨 포함 총 140kg)
- YOLO는 겹친 원판 스택을 하나의 bbox로 감지 → "20kg 원판이 있다"까지만 알 수 있고, "몇 장인지"는 모름
- 단일 2D 이미지에서 겹친 원판 장수를 추정하는 것이 핵심 난제

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
3. 이미 시도한 접근법과 결과 (전부 실패)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

### 접근법 A: Bbox Aspect Ratio (최고 성적, 현재 채택 중)
- **원리**: 겹친 원판이 많을수록 bbox가 두꺼워지므로, 종횡비(aspect ratio)로 장수 추정
- **수식**: 장수 = (aspect_ratio - 1.0) / thickness_ratio
  - 20kg: thickness_ratio = 0.116 (IWF 표준 기준)
- **EMA 안정화**: alpha=0.3, 새 값 30% + 이전 값 70%
- **Hold Counter**: 장수가 3프레임 연속 바뀌어야 확정
- **Cold Start Skip**: 첫 3프레임 무시

**실제 헬스장 테스트 결과 (Galaxy Note 20 Ultra, 전면 카메라)**:
| 시나리오 | 결과 |
|---------|------|
| 20kg × 1장 | ✅ 정확 |
| 20kg × 2장 | ✅ 3/4 성공 (75%) |
| 20kg × 3장 | ✅ 성공 |
| 5kg × 1장 | ❌ 1→2장 오판 (30→40kg) |
| 첫 측정 | ❌ 140kg (Cold Start, 이후 수정) |

**물리적 한계 분석**:
- 신호(1장→2장 aspect ratio 변화): 0.217 (30° 각도 기준)
- 잡음(bbox 지터+렌즈왜곡+원판 불규칙 등 RSS): ±0.10~0.12
- SNR ≈ 2.0 → 이론적 정확도 ~70%
- **최적 촬영 각도**: 바벨축 기준 15-30° (정면에서 비스듬히)
- **정면(0-10°)에서는 두께가 안 보여서 원리적으로 불가**

### 접근법 B: MiDaS v2.1 단안 Depth Estimation
- **원리**: 단안 깊이 추정으로 원판 스택의 깊이 차이 측정
- **결과**: ❌ 완전 실패 — MiDaS 크래시 또는 depth 출력이 원판과 무관

### 접근법 C: Sobel Edge Histogram Peak Counting
- **원리**: 에지 검출 → 수직 프로젝션 히스토그램 → 피크 수 = 장수
- **결과**: ❌ 완전 실패 — 메탈 반사+조명 노이즈로 1장을 3-4장 오판

### 접근법 D: VLM (Gemini 3 Flash Preview)
- **원리**: 사진 1장 + 프롬프트 → LLM이 원판 종류+장수 직접 판단
- **결과**: ❌ 실패 — 최고 정확도 71%, 목표 80% 미달
- **세부**: 원판 종류(20kg vs 10kg)는 맞추지만, 장수 추정에서 일관적으로 실패

### 업계 사례: Tempo (미국, 2020-2024)
- **전용 ToF(깊이) 카메라** + **전용 컬러코딩 원판** 사용
- 공식 FAQ에 "같은 색 원판 2장 겹치지 마세요 — 감지 불가"라고 명시
- **결론**: 전용 하드웨어 + 전용 원판으로도 겹친 원판 장수 감지 실패

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
4. 물리적 제약 조건
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**원판 물리 치수 (IWF 표준)**:
| 원판 | 지름 | 두께 | 두께/지름 비율 |
|------|------|------|-------------|
| 20kg | 450mm | 33-52mm | 7.3~11.6% |
| 15kg | 375mm | 34-45mm | 9.1~12.0% |
| 10kg | 290mm | 34-39mm | 11.7~13.4% |
| 5kg | 248mm | 22-27mm | 8.9~10.9% |
| 2.5kg | 213mm | 16-19mm | 7.5~8.9% |

→ 두께가 지름의 7~13%. 3장 겹쳐도 전체 두께가 지름의 35% 이하.
→ 단일 2D 이미지에서 두께 변화를 통계적으로 유의미하게 감지하기 극히 어려움.

**촬영 환경 (헬스장)**:
- 기기: 일반 스마트폰 전면 카메라 (광각, 720p~1080p)
- 거리: 0.3~1.5m (사용자가 바벨을 카메라 앞으로 가져옴)
- 각도: 제어 불가 (사용자가 자연스럽게 들고 오는 각도)
- 조명: 형광등, LED, 자연광 혼합 — 메탈 반사 강함
- 원판: 검정색 러버 코팅이 80~90% (IWF 컬러코딩은 올림픽/크로스핏 전용)
- 배경: 다른 사람, 랙, 거울 등 복잡

**UX 제약 (절대 조건)**:
- "운동 중 무조작 원칙" — 사용자에게 각도 맞추기, 재촬영, 장수 입력 등 추가 조작 요구 금지
- 자동 감지 → 자동 적용 → 틀리면 사용자가 나중에 수동 수정
- 2장 이상의 사진 촬영(멀티뷰)은 UX상 불가

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
5. 조사 요청 (핵심)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

위 상황을 기반으로 다음을 심층 조사해 주세요:

### Q1: 겹친 동일 객체의 개수 추정 — 학술/산업 SOTA (2023~2026)
- "stacked identical objects counting", "overlapping object counting from single 2D image"
- 제조업(웨이퍼/코인/접시 스택), 물류(팔레트 박스 계수), 농업(과일 더미) 등 유사 도메인
- 각 방법의 정확도, 필요 조건(조명/각도/해상도), 실시간 가능 여부
- **특히**: 단일 2D 이미지 + 비통제 환경에서 성공한 사례가 있는가?

### Q2: Mode A (Aspect Ratio) 개선 가능성
- 현재 SNR ~2.0으로 정확도 ~70%. 이걸 85%+로 올릴 수 있는 방법이 있는가?
- Aspect Ratio 외에 bbox에서 추출할 수 있는 추가 feature가 있는가?
  - bbox 내 텍스처 밀도, 에지 밀도, 색상 분포 등
- 단일 YOLO bbox에서 "두께 정보"를 추출하는 다른 방법론
- Aspect Ratio + 추가 feature를 결합한 경량 회귀 모델 (스마트폰 실시간 가능)

### Q3: YOLO 모델 자체를 "장수 인식"으로 재학습하는 방법
- 현재 5클래스 (plate_10kg 등) → "plate_20kg_x1", "plate_20kg_x2", "plate_20kg_x3" 등으로 확장
- 즉, 겹친 원판 스택 자체를 별도 클래스로 학습
- 이 접근법의 장단점, 필요 데이터량, 기대 정확도
- **유사 사례**: "동전 더미 개수 인식", "칩 스택 높이 추정" 등

### Q4: 3D 정보 추정 접근법 (단일 이미지에서)
- Monocular Depth Estimation (MDE) 최신 모델 (Depth Anything V2, Metric3D v2, UniDepth 등)
  - MiDaS v2.1은 이미 실패했으나, 최신 MDE 모델은 정밀도가 다를 수 있음
  - 원판 두께(33~52mm) 수준의 깊이 차이를 감지할 수 있는가?
- Shape from Shading / 메탈 반사 패턴 분석
  - 원판의 메탈/러버 표면 반사 패턴에서 두께 정보 추출 가능성
- NeRF/3D Gaussian Splatting 등은 멀티뷰 필요 → UX상 불가, 제외

### Q5: 하이브리드 접근법
- YOLO(원판 종류) + 경량 CNN(장수 추정)의 2단계 파이프라인
  - YOLO가 bbox 잡으면 → 해당 영역만 crop → 작은 CNN이 1/2/3/4장 분류
  - 이 CNN이 학습할 수 있는 feature는 무엇인가? (bbox 내 그라데이션, 에지 패턴, 두께감)
- YOLO + Regression Head 추가 (multi-task learning)
  - YOLO backbone에 장수 예측 regression head를 추가로 붙이는 방법
- 시계열 정보 활용 (비디오 기반)
  - 사용자가 바벨을 가져오는 동안 여러 각도가 자연스럽게 촬영됨
  - 이 프레임 시퀀스에서 3D 정보를 복원하는 방법 (Structure from Motion lite?)
  - 각 프레임의 aspect ratio를 시계열로 분석하여 장수 추정 정확도 개선

### Q6: "80% 정확도면 충분하다" 전제하의 실용적 최적 해법
- 완벽한 자동 감지가 아니라, "대부분 맞고 가끔 틀리는" 수준이면 됨
- 현재 Mode A가 20kg에서 75% (3/4) → 이걸 85%로 올리는 가장 현실적인 방법
- 비용, 개발 기간, 스마트폰 실시간 실행 가능성 기준으로 순위 매기기
- "포기하고 수동 입력 UX를 최적화하는 것"도 선택지에 포함해서 비교

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
6. 출력 형식
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

각 질문(Q1~Q6)에 대해:
1. **조사 결과 요약** (3~5줄)
2. **핵심 논문/사례** (제목, 저자, 년도, 핵심 수치)
3. **V2log 적용 가능성** (적용 가능/불가 + 이유)
4. **예상 정확도** (구체적 수치)
5. **구현 난이도** (일/주/월 단위)

최종적으로 Q6에서 **추천 순위 Top 3**를 제시해 주세요.
각 추천에는 "왜 이것이 최선인가"와 "이것이 실패하는 시나리오"를 포함해 주세요.
```

## 프롬프트 끝
