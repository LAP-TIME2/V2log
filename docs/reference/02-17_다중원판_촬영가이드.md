# 다중 원판 촬영 가이드 (2026-02-17)

> 헬스장에서 이 문서를 핸드폰으로 보면서 촬영하세요.

## 왜 촬영하나?

현재 모델: 원판 1개 = 96% 정확 / 겹친 원판 = 실패.
**새 전략**: "바깥 원판만 감지" → 라벨링도 바깥 원판 1개만.

---

## Part 1: 기존 141장 재라벨링 (Roboflow, 집에서)

### 열기

1. https://app.roboflow.com 접속 → 로그인
2. 왼쪽 사이드바 → `v2log-weight-plates` 프로젝트 클릭
3. 상단 `Annotate` 탭 클릭

### 재라벨링 대상 찾기

겹친 원판 사진 = bbox가 2개 이상인 사진. 총 ~141장.

필터로 찾는 법:
- Annotate 페이지 → 필터 아이콘 → "Annotation Count" → "2 or more"
- 또는 썸네일 보면서 원판이 여러 개 끼워진 사진 직접 찾기

### 재라벨링 규칙

**핵심: 바깥(가장 큰 직경) bbox만 남기고, 안쪽 bbox 전부 삭제**

```
예시 1: 20kg + 10kg + 5kg 겹침 사진
  → 20kg bbox만 남기기
  → 10kg bbox 삭제 (클릭 → Delete키)
  → 5kg bbox 삭제

예시 2: 10kg + 5kg 겹침 사진
  → 10kg bbox만 남기기
  → 5kg bbox 삭제

예시 3: 10kg + 10kg 같은 클래스 겹침
  → bbox 1개만 남기기 (둘 중 하나 삭제)
```

### 조작법

1. 사진 클릭 → 편집 모드 진입
2. 삭제할 bbox 클릭 → 선택됨 (파란 테두리)
3. `Delete` 키 또는 오른쪽 라벨 패널에서 휴지통 아이콘
4. 바깥 원판 bbox만 남은 거 확인
5. 오른쪽 상단 `Save` (또는 Ctrl+S)
6. 다음 사진으로 이동 (→ 화살표키)

### 주의

- ❌ 단일 원판 사진은 건드리지 마세요 (bbox 1개짜리)
- ❌ 바깥 원판의 클래스명을 바꾸지 마세요
- ✅ 삭제만 하면 됩니다 (새 bbox 그리기 불필요)

---

## Part 2: 겹친 원판 촬영 (헬스장)

### 준비물

- 스마트폰 1대 (전면 카메라 사용)
- 바벨 1개 + 원판들 (20/15/10/5/2.5kg)

### 촬영 규칙 7가지

1. ✅ **전면 카메라** 사용 (실제 앱과 동일)
2. ✅ **원판을 바벨에 실제로 꽂은 상태**로 촬영
3. ✅ **배경에 다른 기구 보여도 OK** (실제 헬스장 환경)
4. ✅ **조명 다양하게** (밝은 쪽, 어두운 쪽, 형광등 아래)
5. ✅ **바벨 위치 다양하게** (벤치 랙, 스쿼트 랙, 바닥)
6. ❌ **같은 위치에서 연속 촬영 금지** (조금씩 바꾸기)
7. ❌ **손이 원판 가리면 안 됨** (촬영 후 손 빼기)

### 각도 분배 (조합당 30장 기준)

| 각도 | 설명 | 매수 |
|------|------|------|
| 정면 0° | 바벨 끝을 카메라에 정면으로 | 8장 |
| 살짝 비틈 10~20° | 약간 기울어진 각도 | 8장 |
| 약간 비틈 20~30° | 옆면 살짝 보이는 각도 | 6장 |
| 가까이 30~50cm | 원판이 화면 50%+ 차지 | 4장 |
| 보통 거리 1~1.5m | 원판이 화면 15~30% | 4장 |

---

### 촬영 조합표 (체크하면서 진행)

#### 2장 다른 클래스 (바깥 원판만 라벨링)

| # | 조합 | 라벨 | 매수 | 완료 |
|---|------|------|------|------|
| 1 | 20+10 | plate_20kg | 30 | ☐ |
| 2 | 20+5 | plate_20kg | 30 | ☐ |
| 3 | 20+15 | plate_20kg | 20 | ☐ |
| 4 | 15+10 | plate_15kg | 20 | ☐ |
| 5 | 15+5 | plate_15kg | 20 | ☐ |
| 6 | 10+5 | plate_10kg | 30 | ☐ |
| 7 | 10+2.5 | plate_10kg | 20 | ☐ |
| 8 | 5+2.5 | plate_5kg | 20 | ☐ |

#### 3장 다른 클래스

| # | 조합 | 라벨 | 매수 | 완료 |
|---|------|------|------|------|
| 9 | 20+10+5 | plate_20kg | 30 | ☐ |
| 10 | 20+15+10 | plate_20kg | 20 | ☐ |
| 11 | 15+10+5 | plate_15kg | 20 | ☐ |

#### 2장 같은 클래스

| # | 조합 | 라벨 | 매수 | 완료 |
|---|------|------|------|------|
| 12 | 10+10 | plate_10kg | 30 | ☐ |
| 13 | 5+5 | plate_5kg | 30 | ☐ |
| 14 | 20+20 | plate_20kg | 20 | ☐ |

#### 혼합 (같은+다른)

| # | 조합 | 라벨 | 매수 | 완료 |
|---|------|------|------|------|
| 15 | 20+10+10 | plate_20kg | 20 | ☐ |
| 16 | 10+10+5 | plate_10kg | 20 | ☐ |

#### 네거티브 (오감지 방지)

| # | 대상 | 라벨 | 매수 | 완료 |
|---|------|------|------|------|
| 17 | 빈 바벨 (원판 없음) | 없음 | 30 | ☐ |
| 18 | 바벨 클립만 | 없음 | 20 | ☐ |
| 19 | 배경 랙 원판 (멀리서) | 없음 | 30 | ☐ |

**총 ~480장**

---

### 효율적 촬영 순서

원판 교체를 최소화하는 순서:

```
1. 빈 바벨 촬영 (30장) — #17

2. 바벨 클립만 끼우기 → 촬영 (20장) — #18

3. 5kg 1장 끼우기
   → 5+2.5 촬영 (20장) — #8
   → 5+5 촬영 (30장) — #13

4. 10kg 세팅
   → 10+5 촬영 (30장) — #6
   → 10+2.5 촬영 (20장) — #7
   → 10+10 촬영 (30장) — #12
   → 10+10+5 촬영 (20장) — #16

5. 15kg 세팅
   → 15+5 촬영 (20장) — #5
   → 15+10 촬영 (20장) — #4
   → 15+10+5 촬영 (20장) — #11

6. 20kg 세팅
   → 20+5 촬영 (30장) — #2
   → 20+10 촬영 (30장) — #1
   → 20+15 촬영 (20장) — #3
   → 20+10+5 촬영 (30장) — #9
   → 20+15+10 촬영 (20장) — #10
   → 20+20 촬영 (20장) — #14
   → 20+10+10 촬영 (20장) — #15

7. 배경 랙 촬영 — 멀리서 (30장) — #19
```

### 하나의 조합 촬영 예시 (10+5, 30장)

```
벤치프레스 랙:
  정면 50cm  📸📸   비틈15° 50cm  📸📸
  정면 1m    📸📸   비틈15° 1m    📸📸    = 8장

스쿼트 랙으로 이동:
  정면 50cm  📸📸   비틈20° 50cm  📸📸
  정면 1m    📸📸   비틈20° 1m    📸📸    = 8장

바닥에 내려놓기:
  정면 1m    📸📸📸  비틈10° 1m   📸📸📸
  비틈25° 50cm 📸📸📸  비틈25° 1m 📸📸📸  = 12장

  ⚠️ 조명/배경 다양하게!
  = 28~30장 완료
```

---

## Part 3: 업로드 + 라벨링 (Roboflow, 집에서)

### Step 1: 사진 업로드

1. Roboflow → `v2log-weight-plates` 프로젝트
2. 상단 `Upload` 탭
3. 촬영한 사진 폴더를 드래그 앤 드롭
4. `Upload N Images` 클릭
5. ⚠️ "Split" 물어보면 → ✅ Auto Split (Train/Valid/Test 자동 분배)

### Step 2: 라벨링

**규칙: 바깥(가장 큰 직경) 원판 1개만 bbox 라벨링**

1. `Annotate` 탭 → 라벨 안 된 사진 선택
2. 왼쪽 도구에서 `Bounding Box` 선택 (단축키: B)
3. 바깥 원판 하나만 드래그해서 bbox 그리기
4. 클래스 선택 (조합표의 "라벨" 열 참고)
5. Save → 다음 사진

**네거티브 사진** (빈 바벨, 배경 랙):
- bbox 안 그리고 그냥 Save (라벨 없이 업로드)
- 이러면 YOLO가 "이건 원판이 아님"을 학습

### Step 3: Dataset 생성

1. 왼쪽 사이드바 → `Generate` 클릭
2. Preprocessing:
   - ✅ Auto-Orient
   - ✅ Resize: Stretch to 640×640
3. Augmentation:
   - ✅ Brightness: ±25%
   - ✅ Rotation: ±15°
   - ✅ Blur: 최대 2.5px
   - ✅ Noise: 최대 3%
   - ❌ 큰 회전(30°+) 사용 금지
   - ❌ 수직 뒤집기 사용 금지
   - ❌ Mosaic 사용 금지
4. `Generate` 클릭 → Dataset v3 생성
5. 포맷: ✅ YOLOv8 선택

---

## Part 4: Colab 재학습

기존 V2log_YOLO_Training.ipynb 노트북 사용.

### 변경할 값

```python
# data.yaml 다운로드 후 확인: 5개 클래스 동일한지 체크
# plate_10kg, plate_15kg, plate_2.5kg, plate_20kg, plate_5kg

from ultralytics import YOLO
model = YOLO('yolo26n.pt')
results = model.train(
    data='data.yaml',
    epochs=150,       # 데이터 많아졌으니 100 → 150
    imgsz=640,
    batch=16,
    patience=30,      # 30 에폭 동안 개선 없으면 자동 중단
)
```

### 목표 성능

| 지표 | 목표 | v2 결과 (참고) |
|------|------|---------------|
| mAP50 | ≥ 85% | 96.2% |
| mAP50-95 | ≥ 70% | 85.3% |

> 데이터가 더 어려워졌으니 (겹친 원판) 수치가 약간 떨어질 수 있음. 정상.

### TFLite 변환

```python
model = YOLO('runs/detect/train/weights/best.pt')
model.export(format='tflite', imgsz=640, int8=False)
```

### 앱 전달

변환된 `.tflite` 파일을 → `V2log/assets/models/weight_plate.tflite` 교체

---

## 검증 체크리스트

### 모델 검증

- [ ] mAP50 ≥ 85%
- [ ] 10kg 단일 → plate_10kg (기존 기능 유지)
- [ ] 10+5 겹침 → plate_10kg (바깥만, 20kg 오분류 안 함)
- [ ] 10+10 겹침 → plate_10kg (hallucination 없음)
- [ ] 빈 바벨 → 감지 없음 (false positive 0)

### 앱 실기기 검증

- [ ] 단일 원판 정확도 유지 (≥ 90%)
- [ ] 겹친 원판에서 오분류 감소
- [ ] 배경 랙 원판 오감지 없음
