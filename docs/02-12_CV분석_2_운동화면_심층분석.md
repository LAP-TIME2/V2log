# V2log ìš´ë™ í™”ë©´ ì‹¬ì¸µ ë¶„ì„ â€” CV í†µí•© ê´€ì 

> ë¶„ì„ì¼: 2026-02-12 | ëª©ì : ìš´ë™(Workout) í™”ë©´ì— CV ê¸°ëŠ¥ì„ í†µí•©í•  ìˆ˜ ìˆëŠ”ì§€ í‰ê°€

---

## 1. WorkoutScreen ìœ„ì ¯ íŠ¸ë¦¬ êµ¬ì¡°

```
WorkoutScreen (ConsumerStatefulWidget)
â”œâ”€â”€ AppBar (ì‹œê°„ í‘œì‹œ)
â”œâ”€â”€ Column [ìŠ¤í¬ë¡¤ ë¶ˆê°€]
â”‚   â”œâ”€â”€ ExerciseProgress (í”„ë¦¬ì…‹ ëª¨ë“œ)
â”‚   â”œâ”€â”€ ExerciseGuideCard (ìš´ë™ ì •ë³´ + ë¯¸ë‹ˆê·¼ìœ¡ë§µ + ë©”ëª¨ ì•„ì´ì½˜)
â”‚   â””â”€â”€ MiniMuscleMap (ê·¼ìœ¡ ì‹œê°í™”)
â”œâ”€â”€ SetList (ìŠ¤í¬ë¡¤ ê°€ëŠ¥)
â”‚   â”œâ”€â”€ SetRowHeader
â”‚   â””â”€â”€ ListView.builder (ê° ì„¸íŠ¸)
â”‚       â””â”€â”€ SetRow (ì„¸íŠ¸ ë²ˆí˜¸/íƒ€ì…/ë¬´ê²Œ/íšŸìˆ˜ + ìƒíƒœ ì•„ì´ì½˜)
â””â”€â”€ BottomFixedArea [ìŠ¤í¬ë¡¤ ë¶ˆê°€]
    â”œâ”€â”€ RestTimerWidget (ì»´íŒ©íŠ¸ ëª¨ë“œ)
    â”œâ”€â”€ IntensityZoneIndicator (ê°•ë„ ì¡´ í‘œì‹œ)
    â”œâ”€â”€ QuickInputControl (ë¬´ê²Œ/íšŸìˆ˜ íœ  í”¼ì»¤)
    â””â”€â”€ BottomButtons (ì„¸íŠ¸ì™„ë£Œ/ë‹¤ìŒìš´ë™)
```

**í‰ê°€**: ê° ê³„ì¸µì´ ë…ë¦½ì ì´ë¼ CV ì¹´ë©”ë¼ ë ˆì´ì–´ ì‚½ì… ìš©ì´ âœ…

**CV ì¹´ë©”ë¼ ì¶”ê°€ ìµœì  ìœ„ì¹˜**:
- ìƒë‹¨ê³¼ ì„¸íŠ¸ ë¦¬ìŠ¤íŠ¸ ì‚¬ì´ì— ì¹´ë©”ë¼ í”„ë¦¬ë·° (íƒ­ìœ¼ë¡œ ì „í™˜)
- ë˜ëŠ” ExerciseGuideCard ìœ„ì— ì˜¤ë²„ë ˆì´ í˜•íƒœ

---

## 2. ìƒíƒœ ê´€ë¦¬ íŒ¨í„´ (3ë‹¨ê³„ Provider êµ¬ì¡°)

| ë ˆì´ì–´ | Provider | ì—­í•  | CV í˜¸í™˜ |
|--------|----------|------|---------|
| ì„¸ì…˜ | `activeWorkoutProvider` | ì „ì²´ ì„¸ì…˜ ê´€ë¦¬ | âœ… ë§¤ìš° ìš©ì´ |
| íƒ€ì´ë¨¸ | `restTimerProvider`, `workoutTimerProvider` | ë…ë¦½ì  íƒ€ì´ë¨¸ | âœ… ìš©ì´ |
| UI ìƒíƒœ | `_currentWeight`, `_currentReps` (StatefulWidget) | ë¡œì»¬ ìƒíƒœ | âœ… ìš©ì´ |

### CV ë°ì´í„° í†µí•© ì§€ì 

```dart
// í˜„ì¬ (ìˆ˜ë™ ì…ë ¥)
onWeightChanged: (value) => setState(() => _currentWeight = value),
onRepsChanged: (value) => setState(() => _currentReps = value),

// CV ì—°ë™ ì‹œ (ìë™ ì…ë ¥) â€” ê°™ì€ ê²½ë¡œ!
_updateFromCvDetection(weight, reps) {
  setState(() {
    _currentWeight = weight;
    _currentReps = reps;
  });
}
```

**í•µì‹¬**: `setState` í˜¸ì¶œ ê²½ë¡œê°€ ëª…í™• â†’ CV ê°’ì„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ ê°€ëŠ¥ âœ…

---

## 3. ì„¸íŠ¸ ì…ë ¥ ë°©ì‹ ì „í™˜ ê°€ëŠ¥ì„±

### í˜„ì¬ ì…ë ¥ ë©”ì»¤ë‹ˆì¦˜
```dart
// QuickInputControl: íœ  í”¼ì»¤ë¡œ ìˆ˜ë™ ì¡°ì •
ListWheelScrollView + _VerticalButtonColumn

// addSet() í˜¸ì¶œ:
await ref.read(activeWorkoutProvider.notifier).addSet(
  exerciseId: exerciseId,
  weight: _currentWeight,
  reps: _currentReps,
  setType: _currentSetType,
);
```

### ì „í™˜ ì „ëµ (ìˆ˜ë™/ìë™/í•˜ì´ë¸Œë¦¬ë“œ)
```dart
enum InputMode { manual, cv, hybrid }

class _WorkoutScreenState {
  InputMode _inputMode = InputMode.manual;

  void _onCvDetected(CvResult result) {
    if (_inputMode == InputMode.cv || _inputMode == InputMode.hybrid) {
      setState(() {
        _currentWeight = result.detectedWeight;
        _currentReps = result.detectedReps;
      });
    }
  }

  // ìˆ˜ë™ ì¡°ì •ë„ ì—¬ì „íˆ ê°€ëŠ¥
  void _onManualWeightChanged(double value) {
    setState(() => _currentWeight = value);
  }
}
```

**í‰ê°€**: âœ… ë§¤ìš° ìš©ì´ â€” `_currentWeight`ì™€ `_currentReps` ë³€ìˆ˜ë§Œ ê°±ì‹ í•˜ë©´ ë¨

---

## 4. í™”ë©´ ë¦¬ë¹Œë“œ ë¹ˆë„ & ì„±ëŠ¥ ì˜í–¥

### í˜„ì¬ ë¦¬ë¹Œë“œ íŠ¸ë¦¬ê±°

| íŠ¸ë¦¬ê±° | ë¹ˆë„ | ì˜í–¥ ë²”ìœ„ |
|--------|------|----------|
| `activeWorkoutProvider` ë³€ê²½ | ì„¸íŠ¸ ì™„ë£Œ ì‹œ (1íšŒ/ì„¸íŠ¸) | ì „ì²´ í™”ë©´ |
| `workoutTimerProvider` ë³€ê²½ | ë§¤ 1ì´ˆ | AppBarë§Œ |
| `restTimerProvider` ë³€ê²½ | ë§¤ 1ì´ˆ (íƒ€ì´ë¨¸ ì‹¤í–‰ ì¤‘) | RestTimerWidgetë§Œ |
| `setState()` (ë¬´ê²Œ/íšŸìˆ˜) | ë§¤ ìŠ¤í¬ë¡¤ | QuickInputControlë§Œ |
| `currentExerciseIndexProvider` | ë‹¤ìŒ/ì´ì „ ìš´ë™ | ì „ì²´ í™”ë©´ |

### CV ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì¶”ê°€ ì‹œ

```dart
// âŒ BAD: ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì „ì²´ rebuild (30 FPS)
StreamBuilder<CvFrame>(
  stream: cameraService.stream,
  builder: (context, snapshot) {
    return WorkoutScreen(detectedWeight: snapshot.data?.weight);
  },
);

// âœ… GOOD: ì¹´ë©”ë¼ ë·°ë§Œ ë³„ë„ ìœ„ì ¯ + ê°ì§€ ê²°ê³¼ë§Œ ì½œë°±
_CameraPreviewLayer(
  onDetected: _onCvDetected,  // ì´ ìœ„ì ¯ë§Œ ê³ ì£¼íŒŒ ë¦¬ë¹Œë“œ
),
```

**ê¶Œì¥ì‚¬í•­**:
- ì¹´ë©”ë¼ í”„ë ˆì„ ì²˜ë¦¬ â†’ ë³„ë„ Provider ë˜ëŠ” StreamController (ê²©ë¦¬)
- ê°ì§€ ê²°ê³¼ â†’ ì½œë°± (setState í˜¸ì¶œ)
- **200ms ë””ë°”ìš´ì‹±** (ì´ˆë‹¹ 5ë²ˆë§Œ UI ê°±ì‹ )

---

## 5. ìš´ë™ ë°ì´í„° ëª¨ë¸ CV ì ì‘ì„±

### WorkoutSetModel êµ¬ì¡°

```dart
const factory WorkoutSetModel({
  required String id,
  required String sessionId,
  required String exerciseId,
  required int setNumber,
  @Default(SetType.working) SetType setType,
  double? weight,          // â† CVê°€ ê°ì§€í•  ê°’
  int? reps,               // â† CVê°€ ê°ì§€í•  ê°’
  double? targetWeight,
  int? targetReps,
  double? rpe,             // â† CV ì‹ ë¢°ë„ ì €ì¥ ê°€ëŠ¥
  int? restSeconds,
  @Default(false) bool isPr,
  String? notes,           // â† CV ê°ì§€ ë©”íƒ€ë°ì´í„° ì €ì¥ ê°€ëŠ¥
  required DateTime completedAt,
}) = _WorkoutSetModel;
```

### CV í•„ë“œ ë§¤í•‘

| í•„ë“œ | CV ê°’ | í™œìš©ë²• |
|------|-------|--------|
| `weight` | í”Œë ˆì´íŠ¸ Ã— ë¬´ê²Œ | âœ… ì§ì ‘ ì‚¬ìš© |
| `reps` | í¬ì¦ˆ ë³€í™” ê°ì§€ íšŸìˆ˜ | âœ… ì§ì ‘ ì‚¬ìš© |
| `rpe` | CV ì‹ ë¢°ë„ (0.0~1.0) | âœ… ì €ì¥ ê°€ëŠ¥ |
| `notes` | `"CVê°ì§€: ì‹ ë¢°ë„92%"` | âœ… ì €ì¥ ê°€ëŠ¥ |

**í‰ê°€**: âœ… ì™„ë²½í•˜ê²Œ ìˆ˜ìš© ê°€ëŠ¥ â€” ê¸°ì¡´ í•„ë“œë¡œ ì¶©ë¶„, ëª¨ë¸ ë³€ê²½ ë¶ˆí•„ìš”

---

## 6. ë¦¬ìŠ¤í¬ ë¶„ì„

| ë¦¬ìŠ¤í¬ | ì‹¬ê°ë„ | ì™„í™” ì „ëµ |
|--------|--------|----------|
| ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ê³ ì£¼íŒŒ ë¦¬ë¹Œë“œ | ğŸ”´ ë†’ìŒ | StreamBuilder ë¶„ë¦¬ + 200ms ë””ë°”ìš´ì‹± |
| gesture ì¶©ëŒ (ì¹´ë©”ë¼ í„°ì¹˜ vs íœ í”¼ì»¤) | ğŸŸ¡ ì¤‘ê°„ | Z-order ëª…í™•í™” + ëª¨ë“œ í† ê¸€ |
| Provider ê²½í•© | ğŸŸ¡ ì¤‘ê°„ | ê°ì§€ ê²°ê³¼ëŠ” ë¡œì»¬ ì½œë°±ìœ¼ë¡œ ì²˜ë¦¬ |
| ëŠë¦° í”Œë ˆì´íŠ¸ ê°ì§€ (100~300ms) | ğŸŸ¡ ì¤‘ê°„ | UI í”¼ë“œë°±(ìŠ¤í”¼ë„ˆ) + íƒ€ì„ì•„ì›ƒ |
| ìì„¸ ê°ì§€ ì˜¤ë¥˜ (MediaPipe 3%) | ğŸ”´ ë†’ìŒ | ì‹ ë¢°ë„ < 0.7 = ìˆ˜ë™ í™•ì¸ í•„ìˆ˜ |

---

## 7. í†µí•© ì•„í‚¤í…ì²˜ ì œì•ˆ

```
WorkoutScreen (ConsumerStatefulWidget)
â”‚
â”œâ”€â”€ 1. ê¸°ì¡´ UI (ë³€ê²½ ì—†ìŒ)
â”‚   â”œâ”€â”€ AppBar
â”‚   â”œâ”€â”€ ExerciseGuideCard
â”‚   â”œâ”€â”€ SetList
â”‚   â””â”€â”€ BottomControls
â”‚
â”œâ”€â”€ 2. CV ë ˆì´ì–´ (ìƒˆë¡œ ì¶”ê°€)
â”‚   â””â”€â”€ CvCameraWidget (ë³„ë„ ìœ„ì ¯)
â”‚       â”œâ”€â”€ StreamBuilder<CameraFrame>
â”‚       â””â”€â”€ onDetected(weight, reps) â†’ _onCvDetected()
â”‚
â”œâ”€â”€ 3. ëª¨ë“œ í† ê¸€ UI
â”‚   â””â”€â”€ AppBar ì•¡ì…˜ ë˜ëŠ” FAB
â”‚       â”œâ”€â”€ "ìˆ˜ë™ ì…ë ¥" (ê¸°ì¡´)
â”‚       â”œâ”€â”€ "CV ê°ì§€" (ì¹´ë©”ë¼)
â”‚       â””â”€â”€ "í•˜ì´ë¸Œë¦¬ë“œ" (ë‘˜ ë‹¤)
â”‚
â””â”€â”€ 4. ìƒíƒœ ê´€ë¦¬ (ê¸°ì¡´ ìœ ì§€)
    â””â”€â”€ activeWorkoutProvider â†’ addSet(weight, reps, ...)
```

### ìˆ˜ì • í•„ìš” íŒŒì¼ (ìµœì†Œ 4ê°œ)

1. `workout_screen.dart` â€” CvCameraWidget + ëª¨ë“œ í† ê¸€ ì¶”ê°€ (~150ì¤„)
2. `workout_provider.dart` â€” ë³€ê²½ ì—†ìŒ (ê¸°ì¡´ addSet() ê·¸ëŒ€ë¡œ)
3. `workout_set_model.dart` â€” ë³€ê²½ ì—†ìŒ (ê¸°ì¡´ í•„ë“œ ì¶©ë¶„)
4. ìƒˆ íŒŒì¼: `camera_service_provider.dart` â€” CV ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬ (~100ì¤„)

---

## 8. ìµœì¢… íŒì •

| í•­ëª© | í‰ê°€ |
|------|------|
| ìœ„ì ¯ ë³µì¡ë„ | âœ… ë‚®ìŒ â€” ê° ê³„ì¸µ ë…ë¦½ì  |
| ìƒíƒœ ê´€ë¦¬ ì¶©ëŒ | âœ… ì—†ìŒ â€” setState ê¸°ë°˜ì´ë¼ CV ì½œë°± ì‰¬ì›€ |
| ì…ë ¥ ì „í™˜ ìš©ì´ì„± | âœ… ë§¤ìš° ë†’ìŒ â€” ë™ì¼ ë³€ìˆ˜ ì‚¬ìš© |
| í™”ë©´ ë¦¬ë¹Œë“œ ì„±ëŠ¥ | âš ï¸ ì£¼ì˜ â€” ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ë¶„ë¦¬ í•„ìˆ˜ |
| ë°ì´í„° ëª¨ë¸ ìˆ˜ìš© | âœ… ì™„ë²½ â€” ê¸°ì¡´ í•„ë“œ ì¶©ë¶„ |
| ì´ ê°œë°œ ë‚œì´ë„ | ğŸŸ¡ ì¤‘ê°„ â€” ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ + ì‹ ë¢°ë„ ë¡œì§ë§Œ ì£¼ì˜ |

**ê²°ë¡ **: V2log ìš´ë™ í™”ë©´ì€ CV ê¸°ëŠ¥ í†µí•©ì— ë§¤ìš° ì í•©. ê¸°ì¡´ ì½”ë“œë¥¼ ê±°ì˜ ê±´ë“œë¦¬ì§€ ì•Šê³  ì¹´ë©”ë¼ ë ˆì´ì–´ ì¶”ê°€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥. âœ…
